# Инструкция по настройке камеры и детекции

## Как работает детекция нарушений

Система использует предобученную модель YOLOv8 для детекции объектов, а затем применяет эвристические правила для определения нарушений:

### 1. Курение
- Детектирует людей с объектами в области лица/рук (cell phone, remote)
- Объекты в верхней части тела могут указывать на сигарету
- **Внимание:** Стандартная YOLO не детектирует сигареты напрямую, поэтому используются косвенные признаки

### 2. Выброс мусора
- Детектирует объекты мусора (bottle, cup, bowl) в области ног человека
- Анализирует историю кадров для определения, появился ли объект недавно
- Объекты на земле рядом с человеком считаются потенциально выброшенными

### 3. Граффити
- Пока не реализовано (требуется специальная модель)

## Запуск системы

### Вариант 1: Тест камеры и детекции (без отправки в Telegram)

```bash
python test_camera.py
```

Этот скрипт:
- Открывает камеру
- Показывает детекции в реальном времени
- Выводит информацию о найденных нарушениях в консоль
- Не отправляет уведомления в Telegram

**Нажмите 'q' для выхода**

### Вариант 2: Полный мониторинг (с отправкой в Telegram)

```bash
python main.py
```

Этот скрипт:
- Открывает камеру
- Детектирует нарушения
- Сохраняет изображения нарушений в папку `violations_evidence/`
- Отправляет уведомления в Telegram с информацией о нарушении

**Нажмите 'q' для выхода**

## Настройка камеры

В файле `.env` настройте источник камеры:

```env
CAMERA_SOURCE=0  # 0 для веб-камеры по умолчанию, или путь к видео файлу
```

Если у вас несколько камер, попробуйте:
- `CAMERA_SOURCE=0` - первая камера
- `CAMERA_SOURCE=1` - вторая камера
- `CAMERA_SOURCE=2` - третья камера и т.д.

Или укажите путь к видео файлу:
```env
CAMERA_SOURCE=path/to/video.mp4
```

## Настройка чувствительности детекции

В файле `.env`:

```env
CONFIDENCE_THRESHOLD=0.5  # Порог уверенности (0.0 - 1.0)
DETECTION_INTERVAL=5      # Интервал детекции в секундах
```

- **CONFIDENCE_THRESHOLD**: Чем выше значение, тем строже детекция (меньше ложных срабатываний, но может пропускать реальные нарушения)
- **DETECTION_INTERVAL**: Как часто проверять кадры на нарушения (в секундах). Меньшее значение = чаще проверка, но больше нагрузка

## Возможные проблемы

### Камера не открывается
- Проверьте, что камера подключена
- Попробуйте другой номер камеры в `.env`
- Убедитесь, что камера не используется другим приложением

### Модель YOLO не загружается
- При первом запуске модель скачается автоматически (требуется интернет)
- Модель `yolov8n.pt` будет сохранена в корне проекта

### Детекция не работает или работает плохо
- Стандартная YOLO модель не детектирует специфические нарушения напрямую
- Используются эвристические правила на основе стандартных классов
- Для продакшена необходима обученная модель на ваших данных

### Ложные срабатывания
- Увеличьте `CONFIDENCE_THRESHOLD` в `.env`
- Настройте освещение в помещении
- Убедитесь, что камера хорошо установлена

## Улучшение точности детекции

Для повышения точности необходимо:

1. **Собрать датасет** с изображениями реальных нарушений
2. **Разметить данные** (аннотировать bounding boxes)
3. **Обучить YOLO модель** на ваших данных
4. **Заменить модель** в `detector.py`:
   ```python
   detector = ViolationDetector(model_path='path/to/your/trained_model.pt')
   ```

## Тестирование

Рекомендуется начать с `test_camera.py` для проверки:
- Работы камеры
- Загрузки модели
- Детекции объектов
- Отображения результатов

После успешного теста можно перейти к полному мониторингу через `main.py`.
